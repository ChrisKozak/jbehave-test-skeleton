<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ng="http://angularjs.org" xml:lang="en" lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" ng:autobind src="js/angular-0.9.18.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/navigator.js"></script>
    <script type="text/javascript" src="js/angular-extensions.js"></script>
    <script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min-1.7.1.js"></script>
    <script type="text/javascript" src="js/jquery-framedialog-1.1.2.js"></script>
    <link rel="stylesheet" type="text/css" href="style/navigator.css"/>
    <link rel="stylesheet" type="text/css" href="style/jquery-ui.css"/>
    <title>Story Navigator</title>
</head>
<body ng:controller="MyController">

<script type="text/javascript">
    $(document).ready(function() {

        $("#tabs").tabs();
        $("#scenario-toggle").click(showScenarios);
    });
</script>

<div id="page-wrap">
    <div id="inside">
        <div id="top-bar">
            <img src="images/logo.svg.png" width="60px" />
            <h1 id="title">Story Navigator</h1>
            <div class="timestamp">Generated by {{data.xref.createdBy}} on {{ data.xref.whenMade | date:'yyyy-MM-dd @ HH:mm'}}
            </div>

        </div>
        <div id="main-content">

            <div id="tabs">
                <ul>
                    <li><a href="#tabs-1">Overview</a></li>
                    <li><a href="#tabs-2">Stories ({{data.xref.stories.$size()}})</a></li>
                    <li><a href="#tabs-3">Steps</a></li>
                </ul>

                <div id="tabs-1">
                    <div id="overview"></div>
                    <table id="overview-table">
                        <thead>
                            <th class="left-aligned"><a href ng:click="overviewPredicate = displayStringFor; reverse = !reverse;">Feature</a></th>
                            <th><a href ng:click="overviewPredicate = totalScenariosFor; reverse = !reverse;">Total</a></th>
                            <th><a href ng:click="overviewPredicate = successesFor; reverse = !reverse;">Successes</a></th>
                            <th><a href ng:click="overviewPredicate = failuresFor; reverse = !reverse;">Failures</a></th>
                            <th><a href ng:click="overviewPredicate = successRateFor; reverse = !reverse;">Success Rate</a></th>
                        </thead>
                        <tbody>
                            <tr class="overview-row feature-passed-{{failuresFor(feature) == 0}}" ng:click="showStoriesFor(feature)" ng:init="overviewPredicate=''; reverse = false" ng:repeat="feature in data.xref.metaTags.$filter('Feature=').$orderBy(overviewPredicate, reverse)">
                                <td class="feature-name left-aligned">{{displayStringFor(feature)}}</td>
                                <td>{{totalScenariosFor(feature) | blackZero | html}}</td>
                                <td class="passed-true">{{successesFor(feature) | blackZero | html}}</td>
                                <td class="passed-false">{{failuresFor(feature) | blackZero | html}}</td>
                                <td>{{successRateFor(feature) | floor | colorByTranche | html}} %</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td>TOTALS</td>
                                <td>{{totalScenariosFor()}}</td>
                                <td class="passed-true">{{successesFor()}}</td>
                                <td class="passed-false">{{failuresFor() | blackZero | html}}</td>
                                <td>{{successRateFor() | floor | colorByTranche | html}} %</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div id="tabs-2">
                    <span></span>

                    <div id="totals">
                        <h1>Showing {{filterStories(search).$size()}} stories (out of {{data.xref.stories.$size()}})</h1>
                        <h3 id="scenarios-total">Containing {{totalScenariosFor(search)}} scenarios (out of {{totalScenariosFor()}})</h3>
                        <a href id="scenario-toggle">Show scenario titles</a>

                        <br>
                        <br>
                        <br>
                        <h4>The current listing has {{totalScenariosFor(search, {passed:false})}} scenarios failing.</h4>
                        <div class="legend">
                            <h3>Legend:</h3>
                            <span class="passed-true">successful</span>
                            <span class="passed-false">failed</span>
                            <span class="passed-true known-issue-true">known issue passed</span>
                            <span class="passed-false known-issue-true">known issue failed</span>
                        </div>
                    </div>

                    <div id="searchCriteria">
                        <fieldset>
                            <label>Pass / Fail</label>

                            <select ng:init="search.passed=''" name="search.passed" class="filterInput">
                                <option value="e" selected="selected">- Show All -</option>
                                <option value="true">Successes</option>
                                <option value="false">Failures</option>
                            </select>
                        </fieldset>

                        <fieldset>

                            <label>Filter</label><input name="search.scenarios" class="filterInput"/>
                        </fieldset>
                    </div>

                    <table id="stories-table" summary="Navigator" cellspacing="0" cellpadding="0">
                        <colgroup>
                            <col class="path"/>
                            <col class="failure"/>
                            <col class="knownIssue"/>

                            <col class="duration"/>
                        </colgroup>
                        <thead>
                        <tr class="columnTitles">
                                <th class="path">
                                    <a href ng:click="reverse = !reverse; predicate = 'readableName'">Path</a>
                                </th>

                                <th class="failure">Failures</th>

                                <th class="knownIssue">
                                    <a href ng:click="reverse = !reverse; predicate = 'knownIssue'">Known Issue</a>
                                </th>

                                <th class="duration last">
                                    <a href ng:click="reverse = !reverse; predicate = 'duration'">Duration</a>
                                </th>
                            </tr>
                            <tr>
                                <th class="path search"></th>

                                <th/>
                                <th/>
                                <th class="duration total">{{humanReadableDuration(filterStories(search).$sum('duration'))}}</th>
                            </tr>
                        </thead>
                        <tfoot>
                        <tr>
                            <td colspan="4">&nbsp;</td>

                        </tr>
                        </tfoot>
                        <tbody>
                        <tr ng:init="reverse = false" ng:repeat="story in filterStories(search).$orderBy(predicate, reverse)"
                            ng:click="showResults(story)" title="Click to view the story details">
                            <td class="path passed-{{story.passed}} known-issue-{{story.hasKnownIssue}}">
                                <a onclick="return false;" href="{{story.html}}">{{story.readableName | truncateTo80}}</a>
                                <ul class="scenario-titles">
                                    <li ng:repeat="result in story.scenarioResults">
                                        <span class="passed-{{result.passed}} known-issue-{{story.hasKnownIssue}}">{{result.title | truncateTo80}}</span>
                                    </li>

                                </ul>
                            </td>
                            <td class="failure">
                                <p>&nbsp;</p>
                                <ul class="scenario-failures">
                                    <li ng:repeat="result in story.scenarioResults">
                                        <span class="passed-{{result.passed}} known-issue-{{story.hasKnownIssue}}">{{result.failure | truncate}}&nbsp;</span>
                                    </li>

                                </ul>
                            </td>
                            <td class="knownIssue">{{story.knownIssue | truncate}}</td>
                            <td class="duration">{{humanReadableDuration(story.duration)}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- The Step-Match List Tab -->

                <div id="tabs-3">
                    <table cellspacing="0" cellpadding="0">
                        <thead>
                        <tr>
                            <th colspan="7" class="section">Steps</th>
                        </tr>

                        <tr class="columnTitles">
                            <th class="type first">
                                <a href ng:click="reverse = !reverse; stepPredicate = 'type'">Type</a>
                            </th>
                            <th class="pattern">
                                <a href ng:click="reverse = !reverse; stepPredicate = 'annotatedPattern'">Step</a>
                            </th>
                            <th class="successfulOccurrences">
                                <a href ng:click="reverse = !reverse; stepPredicate = 'occurrences.$filter({outcome:\'PASSED\'}).$size()'">Passed</a>
                            </th>
                            <th class="failedOccurrences">
                                <a href ng:click="reverse = !reverse; stepPredicate = 'occurrences.$filter({outcome:\'FAILED\'}).$size()'">Failed</a>
                            </th>
                            <th>
                                <a href ng:click="reverse = !reverse; stepPredicate = 'occurrences.$filter({outcome:\'PENDING\'}).$size()'">Pending</a>
                            </th>
                            <th>
                                <a href ng:click="reverse = !reverse; stepPredicate = 'occurrences.$filter({outcome:\'NOT_PERFORMED\'}).$size()'">Skipped</a>
                            </th>
                            <th class="occurrences last">
                                <a href ng:click="reverse = !reverse; stepPredicate = 'occurrences.$size()'">Occurrences</a>
                            </th>
                        </tr>
                        <tr class="filters">
                            <th>
                                <select ng:init="stepSearch.type = ''" name="stepSearch.type">
                                    <option value="" selected="selected">- All -</option>
                                    <option selected>Given</option>
                                    <option selected>When</option>

                                    <option selected>Then</option>
                                </select>
                            </th>
                            <th><input name="stepSearch.annotatedPattern" class="filterInput"/></th>
                            <th>&nbsp;</th>
                            <th>&nbsp;</th>
                            <th>&nbsp;</th>
                            <th>&nbsp;</th>

                            <th>&nbsp;</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng:init="stepPredicate=''; reverse = false" ng:repeat="match in data.xref.stepOccurrences.$filter(stepSearch).$orderBy(stepPredicate, reverse)" ng:click="showOccurrences(match)">
                            <td class="type">{{match.type}}</td>
                            <td class="pattern">{{match.annotatedPattern}}</td>
                            <td class="passed-true count">{{match.occurrences.$filter({outcome:'PASSED'}).$size() | blackZero | html}}</td>
                            <td class="count"><span class="passed-false">{{match.occurrences.$filter({outcome:'FAILED'}).$size() | blackZero | html}}</span><span class="passed-false-known-issue"> {{match.occurrences.$filter({outcome:'FAILED', isKnownIssue:true}).$size() | hideZeroAndParens}}</span></td>
                            <td class="count">{{match.occurrences.$filter({outcome:'PENDING'}).$size() | blackZero | html}}</td>
                            <td class="count">{{match.occurrences.$filter({outcome:'NOT_PERFORMED'}).$size() | blackZero | html}}</td>
                            <td class="size count">{{match.occurrences.$size()}}</td>
                            <!-- <td class="size">{{match.occurrences[0].story}}</td> -->
                        </tr>
                        </tbody>

                    </table>
                </div>

            </div>
        </div>
        <div style="clear: both;"></div>

    </div>
</div>
</body>
</html>